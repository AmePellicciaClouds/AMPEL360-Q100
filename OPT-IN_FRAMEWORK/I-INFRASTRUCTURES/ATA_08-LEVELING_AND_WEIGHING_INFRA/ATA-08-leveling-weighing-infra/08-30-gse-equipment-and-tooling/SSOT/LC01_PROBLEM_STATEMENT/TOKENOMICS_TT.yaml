# =============================================================================
# TOKENOMICS_TT.yaml — LC01 GSE Equipment and Tooling (08-30)
# =============================================================================
# Teknia Token (TT) reward allocation for uncertainty resolution
# OPT-IN Axis: I-INFRASTRUCTURES / ATA 08-30-gse-equipment-and-tooling
# Version: 1.0.0
# Created: 2026-01-11
# =============================================================================

tokenomics:
  version: "3.14"
  token_symbol: "TT"
  unit: "deg"
  deg_per_tt: 360
  description: "Reward pool for GSE Equipment and Tooling uncertainty resolution"

# -----------------------------------------------------------------------------
# Node-Level Pool Allocation
# -----------------------------------------------------------------------------
node_pool:
  node_id: "08-30-GSE-EQUIPMENT-TOOLING"
  ata_reference: "08-30"
  opt_in_axis: "I-INFRASTRUCTURES"
  total_pool_tt: 600
  total_pool_deg: 216000
  allocation_date: "2026-01-11"
  expiry_date: "2026-12-31"
  status: "ACTIVE"

# -----------------------------------------------------------------------------
# Per-KNOT Reward Pools
# -----------------------------------------------------------------------------
knot_pools:
  - knot_id: "KNOT-08-30-001"
    title: "BWB Jack Point Configuration"
    pool_tt: 100
    pool_deg: 36000
    complexity_factor: 1.0
    status: "OPEN"
    
  - knot_id: "KNOT-08-30-002"
    title: "Load Cell Range and Accuracy"
    pool_tt: 100
    pool_deg: 36000
    complexity_factor: 1.0
    status: "OPEN"
    
  - knot_id: "KNOT-08-30-003"
    title: "LH₂ State Compensation Algorithm"
    pool_tt: 100
    pool_deg: 36000
    complexity_factor: 1.2  # Higher complexity due to novel thermodynamics
    status: "OPEN"
    
  - knot_id: "KNOT-08-30-004"
    title: "Composite Adapter Materials"
    pool_tt: 100
    pool_deg: 36000
    complexity_factor: 0.9
    status: "OPEN"
    
  - knot_id: "KNOT-08-30-005"
    title: "Digital Integration Protocol"
    pool_tt: 100
    pool_deg: 36000
    complexity_factor: 1.0
    status: "OPEN"
    
  - knot_id: "KNOT-08-30-006"
    title: "Safety Interlock Architecture"
    pool_tt: 100
    pool_deg: 36000
    complexity_factor: 1.1  # Safety-critical premium
    status: "OPEN"

# -----------------------------------------------------------------------------
# Eligibility Rules
# -----------------------------------------------------------------------------
eligibility:
  require_status:
    - "COMPLETE"
    - "ACCEPTED"
  require_links_resolved: true
  require_brex_pass_for_pub: true
  require_signoff_from:
    - "STK_GSE"
    - "STK_SE"
  excluded_statuses:
    - "CANCELLED"
    - "SUPERSEDED"

# -----------------------------------------------------------------------------
# Allocation Algorithm
# -----------------------------------------------------------------------------
allocation:
  method: "effort_plus_impact"
  description: |
    Rewards are distributed using a weighted combination of effort and impact.
    Impact includes both direct uncertainty reduction and spillover effects
    on adjacent KNOTs.
  
  formula: |
    w_i = α · Ê_i + (1 - α) · Î_i
    T_i = P_k · w_i
    
    Where:
    - P_k = Pool amount (TT) for the KNOT
    - α = Effort weight
    - Ê_i = Normalized effort: E_i / Σ E_i
    - Î_i = Normalized impact: I_i / Σ I_i
    - I_i = Effective impact: ΔR_k,i + λ · S_i
    - S_i = Spillover: Σ(a_k→j · ΔR_j,i) for adjacent KNOTs
    - λ = Spillover multiplier
  
  params:
    alpha_effort: 0.30          # 30% weight on effort
    alpha_impact: 0.70          # 70% weight on impact
    lambda_spillover: 0.50      # Spillover multiplier for adjacent KNOTs
    min_effort_threshold: 1     # Minimum effort to qualify
    min_impact_threshold: 5     # Minimum residual reduction to qualify
    rounding: "floor_deg"       # Round down to nearest degree

# -----------------------------------------------------------------------------
# Impact Measurement
# -----------------------------------------------------------------------------
measurement:
  residual_scale:
    min: 0
    max: 100
    description: "0 = fully resolved, 100 = completely unknown"
  
  required_fields_per_knu:
    - effort_predicted            # E_i (story points or normalized hours)
    - effort_actual               # Actual effort expended
    - delta_residual_primary      # ΔR_k,i (direct impact on parent KNOT)
    - delta_residual_adjacent_sum # S_i (spillover impact sum)
    - verification_status         # Must be COMPLETE or ACCEPTED
    - linked_artifacts            # Artifact URIs for traceability
  
  impact_calculation:
    direct_weight: 1.0
    spillover_weight: 0.5
    max_spillover_knus: 5         # Cap on adjacent KNU contributions

# -----------------------------------------------------------------------------
# Adjacency Matrix (Spillover Relationships)
# -----------------------------------------------------------------------------
adjacency:
  description: |
    Defines spillover relationships between KNOTs. A value of 1.0 indicates
    strong dependency; 0.0 indicates no relationship.
  
  matrix:
    KNOT-08-30-001:
      KNOT-08-30-002: 0.6   # Jack points affect weighing placement
      KNOT-08-30-004: 0.8   # Jack points drive adapter design
      KNOT-08-30-006: 0.7   # Jack config affects interlock design
    
    KNOT-08-30-002:
      KNOT-08-30-001: 0.3   # Weighing constraints may affect jack points
      KNOT-08-30-003: 0.9   # Load cell specs feed algorithm
      KNOT-08-30-005: 0.7   # Weighing data feeds digital interface
    
    KNOT-08-30-003:
      KNOT-08-30-002: 0.5   # Algorithm may refine accuracy requirements
      KNOT-08-30-005: 0.8   # Algorithm outputs via digital interface
    
    KNOT-08-30-004:
      KNOT-08-30-001: 0.4   # Adapter constraints may affect jack positions
      KNOT-08-30-006: 0.5   # Adapter wear affects safety monitoring
    
    KNOT-08-30-005:
      KNOT-08-30-002: 0.3   # Data interface may affect equipment selection
      KNOT-08-30-003: 0.4   # Interface may constrain algorithm design
    
    KNOT-08-30-006:
      KNOT-08-30-001: 0.5   # Interlocks constrain jack operations
      KNOT-08-30-004: 0.3   # Interlocks monitor adapter status

# -----------------------------------------------------------------------------
# Closure Criteria
# -----------------------------------------------------------------------------
closure:
  residual_threshold: 15        # Maximum acceptable residual at closure
  required_approvals:
    - authority: "STK_GSE"
      role: "Technical Owner"
    - authority: "STK_SE"
      role: "Systems Authority"
    - authority: "STK_CERT"
      role: "Certification Concurrence"
  
  evidence_requirements:
    - "All KNUs at COMPLETE or ACCEPTED status"
    - "All trace links resolved"
    - "All PUB artifacts pass BREX"
    - "Signoff records in evidence pack"
    - "No open actions from milestone reviews"

# -----------------------------------------------------------------------------
# Distribution Process
# -----------------------------------------------------------------------------
distribution:
  trigger: "KNOT closure approval"
  
  steps:
    - step: 1
      action: "Calculate normalized effort for each KNU"
      formula: "Ê_i = E_i / Σ E_i"
    
    - step: 2
      action: "Calculate direct impact for each KNU"
      formula: "ΔR_k,i = Residual_before - Residual_after (attributed)"
    
    - step: 3
      action: "Calculate spillover impact"
      formula: "S_i = Σ(a_k→j · ΔR_j,i) for adjacent KNOTs"
    
    - step: 4
      action: "Calculate effective impact"
      formula: "I_i = ΔR_k,i + λ · S_i"
    
    - step: 5
      action: "Calculate normalized impact"
      formula: "Î_i = I_i / Σ I_i"
    
    - step: 6
      action: "Calculate weight"
      formula: "w_i = α · Ê_i + (1 - α) · Î_i"
    
    - step: 7
      action: "Calculate token allocation"
      formula: "T_i = P_k · w_i"
    
    - step: 8
      action: "Apply rounding"
      formula: "T_i_deg = floor(T_i × 360)"
    
    - step: 9
      action: "Log to AWARDS_TT.csv"
      fields:
        - timestamp
        - knot_id
        - knu_id
        - owner
        - effort_actual
        - delta_residual_primary
        - delta_residual_adjacent_sum
        - weight
        - tokens_tt
        - tokens_deg
        - tx_id
        - validated_by

# -----------------------------------------------------------------------------
# Audit and Governance
# -----------------------------------------------------------------------------
audit:
  ledger_location: "finance/ledger.json"
  hash_algorithm: "SHA-256"
  retention_period_years: 10
  
  review_triggers:
    - "Pool utilization > 80%"
    - "Distribution dispute"
    - "Timeline extension"
    - "KNOT scope change"
  
  governance:
    pool_modification_authority: "STK_PMO"
    dispute_resolution: "STK_SE"
    final_approval: "Program Director"

# -----------------------------------------------------------------------------
# Metadata
# -----------------------------------------------------------------------------
metadata:
  created_by: "AMPEL360 Baseline Architect"
  created_date: "2026-01-11"
  last_modified: "2026-01-11"
  schema_version: "1.0"
  validation_status: "DRAFT"
  next_review_date: "2026-02-15"
